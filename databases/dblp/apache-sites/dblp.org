##############################################################################
# DBLP
###############################################################################
<VirtualHost *:80>
  ServerAdmin webmaster@localhost
  ServerName dblp.informatik.uni-freiburg.de
  ServerAlias www.dblp.org
  ServerAlias dblp.org
  ServerSignature off

  # NEW(baumgari, 3Dec12): Now it's possible to specify an error document in
  # case of problems (like no query parameters). This error documents are
  # specified in the location directives.
  ProxyErrorOverride On

  # NEW(baumgari, 10Oct13): Added a proper redirection.
  RewriteEngine On
  RewriteRule ^/index.html$ /search/index.php [R]
  RewriteRule ^/$ /search/index.php [R]
  # NEW(baumgari, 13Dec12): Added a proper redirection to the real index.
  #Redirect permanent /index.html http://test.dblp.org/search/index.php

  # Use DBLP as proxy for completesearch xml/json api.
  ProxyPass /apis/search http://localhost:8181
  ProxyPassReverse /apis/search http://localhost:8181

  # NEW(Hannah, 16Aug11).
  ProxyPass /search/api http://localhost:8181
  ProxyPassReverse /search/api http://localhost:8181

  # NEW(baumgari, 21Nov12).
  ProxyPass /search/api-trier http://localhost:8182
  ProxyPassReverse /search/api-trier http://localhost:8182

  # Serve pages under http://www.dblp.org/pers via Trier.
  ProxyPass /pers http://www.informatik.uni-trier.de/~ley/pers
  ProxyPassReverse /pers http://www.informatik.uni-trier.de/~ley/pers

  # Serve pages under http://www.dblp.org/db via Trier.
  ProxyPass /db/dblp.css http://www.informatik.uni-trier.de/~ley/dblp.css
  ProxyPassReverse /db/dblp.css http://www.informatik.uni-trier.de/~ley/dblp.css
  ProxyPass /db http://www.informatik.uni-trier.de/~ley/db
  ProxyPassReverse /db http://www.informatik.uni-trier.de/~ley/db

  # Serve pages under http://www.dblp.org/rec via Trier.
  ProxyPass /rec http://dblp.uni-trier.de/rec
  ProxyPassReverse /rec http://dblp.uni-trier.de/rec

  # The pages under http://www.dblp.org/db contain a JavaScript include for
  # ~ley/www.dblp.org/completesearch.js, which is then (via a Rewrite line in
  # Michael Ley's htaccess) served from http://www.dblp.org (for
  # cross-scripting reasons). But when serving the pages from
  # http://www.dblp.org (via the proxy directives above), the JavaScript should
  # be served directly from our server (again for cross-scripting reasons).
  Alias /~ley/www.dblp.org/ /var/www/www.dblp.org/

  # Allow cross-domain access to the domains of Trier.
  SetEnvIf Origin "http(s)?://(www\.)?((informatik|dblp(s)?|irminen)\.uni-trier\.de|dblp\.dagstuhl\.de)$" AccessControlAllowOrigin=$0$1
  Header always set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin

  DocumentRoot /var/www/www.dblp.org
  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>
  <Directory /var/www/www.dblp.org>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
  </Directory>

  # The following are needed, so that the ProxyPass, ProxyPassReverse from
  # above work.
  <Location /db>
    Order allow,deny
    Allow from all
  </Location>
  <Location /pers>
    Order allow,deny
    Allow from all
  </Location>
  <Location /rec>
    Order allow,deny
    Allow from all
  </Location>
  <Location /apis/search>
    ErrorDocument 502 /search/api.description.html
    ErrorDocument 400 /search/api.description.html
    Order allow,deny
    Allow from all
  </Location>
  <Location /search/api>
    ErrorDocument 502 /search/api.description.html
    ErrorDocument 400 /search/api.description.html
    Order allow,deny
    Allow from all
  </Location>
  <Location /search/api-trier>
    ErrorDocument 502 /search/api-trier.description.html
    ErrorDocument 400 /search/api-trier.description.html
    Order allow,deny
    Allow from all
  </Location>

  ErrorLog /var/log/apache2/dblp-error.log

  # Possible values include: debug, info, notice, warn, error, crit,
  # alert, emerg.
  LogLevel warn

  CustomLog /var/log/apache2/dblp-access.log combined
</VirtualHost>
